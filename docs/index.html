---

title: candidate-exercises-public
keywords: fastai
sidebar: home_sidebar

summary: "This is the answer to the tech assessments for imply. Here you can find the coding exercise explained and the Case Study."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 99_index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Requirements">Requirements<a class="anchor-link" href="#Requirements">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>python 3</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Installing">Installing<a class="anchor-link" href="#Installing">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li><code>git clone git@github.com:theccalderon/imply.git</code></li>
<li><code>cd imply</code></li>
<li><code>pip install -r requirements.txt</code></li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Execute">Execute<a class="anchor-link" href="#Execute">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>python candidate_exercises_public.py path/to/json/file path/to/avro/file path/to/csv/file path/to/final/csv/file</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Part-A:-Coding-Excerise">Part A: Coding Excerise<a class="anchor-link" href="#Part-A:-Coding-Excerise">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The goal is to combine the files, eliminating any duplicates and write to a single .CSV file sorted alphabetically by the city name.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I decided to use <code>pandas</code> since is my go to when dealig with tabular data in python. Dataframes allow us to easily remove duplicates, aggregate data and create new files</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandavro</span> <span class="k">as</span> <span class="nn">pdx</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">combine_files</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">,</span> <span class="n">arvo_filepath</span><span class="p">,</span> <span class="n">csv_filepath</span><span class="p">,</span> <span class="n">output_filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Combines the three files, eliminates duplicates and it sorts the resulting dataset by City Name. Creates </span>
<span class="sd">    a csv file in output_filepath and returns a dataframe with its content</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#reading all the three files</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdx</span><span class="o">.</span><span class="n">read_avro</span><span class="p">(</span><span class="n">arvo_filepath</span><span class="p">))</span>
    <span class="c1">#dropping duplicates</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="c1">#sorting by Name</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="c1">#writing to csv</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_filepath</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;CountryCode&#39;</span><span class="p">,</span><span class="s1">&#39;Population&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_filepath</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_csv</span> <span class="o">=</span> <span class="n">combine_files</span><span class="p">(</span><span class="s1">&#39;CityListA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;CityListB.avro&#39;</span><span class="p">,</span> <span class="s1">&#39;CityList.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;finalDataset.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>00_core.ipynb              arvo.csv
99_index.ipynb             <span class="ansi-cyan-intense-fg ansi-bold">candidate_exercises_public</span>
CONTRIBUTING.md            csv.csv
CityList.csv               <span class="ansi-cyan-intense-fg ansi-bold">docs</span>
CityListA.json             finalDataset.csv
CityListB.avro             json.csv
LICENSE                    settings.ini
Makefile                   setup.py
README.md
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>finalDataset.csv</code> is the resulting csv file</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_csv</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>CountryCode</th>
      <th>Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A CoruÃ±a (La CoruÃ±a)</td>
      <td>ESP</td>
      <td>243402</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aalborg</td>
      <td>DNK</td>
      <td>161161</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Abadan</td>
      <td>IRN</td>
      <td>206073</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Abbotsford</td>
      <td>CAN</td>
      <td>105403</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aberdeen</td>
      <td>GBR</td>
      <td>213070</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-the-count-of-all-rows?">What is the count of all rows?<a class="anchor-link" href="#What-is-the-count-of-all-rows?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To find the count of rows we can just check read the final csv file (created by <a href="/core.html#combine_files"><code>combine_files</code></a>) and check its length</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">final_csv</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2083</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-the-city-with-the-largest-population?">What is the city with the largest population?<a class="anchor-link" href="#What-is-the-city-with-the-largest-population?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To find the city with the largest population we can sort by Population descendingly and grab the first row</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">city_with_largets_population_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">1</span><span class="p">][[</span><span class="s1">&#39;Name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">city_with_largets_population_from_df</span><span class="p">(</span><span class="n">final_csv</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Mumbai (Bombay)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well that's not a suprise isn't it?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-the-total-population-of-all-cities-in-Brazil-(CountryCode-==-BRA)?">What is the total population of all cities in Brazil (CountryCode == BRA)?<a class="anchor-link" href="#What-is-the-total-population-of-all-cities-in-Brazil-(CountryCode-==-BRA)?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To find the total population of all cities in Brazil we select the rows where CountryCode == BRA and then sum the population values.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">total_population_per_country_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">country_code</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CountryCode&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">country_code</span><span class="p">][</span><span class="s1">&#39;Population&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">total_population_per_country_from_df</span><span class="p">(</span><span class="n">final_csv</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>55955012
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-changes-could-be-made-to-improve-your-program's-performance.">What changes could be made to improve your program's performance.<a class="anchor-link" href="#What-changes-could-be-made-to-improve-your-program's-performance.">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The data is currently being read sequentially (one file at the time). To improve performance, we could read the data in parallel since it's coming form different sources. By doing this we would maximize the use of our resources and speed things up.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-would-you-scale-your-solution-to-a-much-larger-dataset-(too-large-for-a-single-machine-to-store)?">How would you scale your solution to a much larger dataset (too large for a single machine to store)?<a class="anchor-link" href="#How-would-you-scale-your-solution-to-a-much-larger-dataset-(too-large-for-a-single-machine-to-store)?">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To scale the solution when the data cannot be stored just in a single machine we can use big data technologies (like Hadoop) which allow clustering multiple computers to analyze massive datasets in parallel more quickly. Hadoop makes it easier to use all the storage and processing capacity in cluster servers, and to execute distributed processes against huge amounts of data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Part-B:-Case-Study">Part B: Case Study<a class="anchor-link" href="#Part-B:-Case-Study">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="From-the-requirements:">From the requirements:<a class="anchor-link" href="#From-the-requirements:">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Dataset structure:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-08-04T18:05:07.054Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;session&quot;</span><span class="p">:</span> <span class="s2">&quot;S74650219&quot;</span><span class="p">,</span>
  <span class="nt">&quot;remote_address&quot;</span><span class="p">:</span> <span class="s2">&quot;172.31.3.170&quot;</span><span class="p">,</span>
  <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.koalastothemax.com/img/koalas3.jpg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;referrer&quot;</span><span class="p">:</span> <span class="s2">&quot;Direct&quot;</span><span class="p">,</span>
  <span class="nt">&quot;timezone_offset&quot;</span><span class="p">:</span> <span class="s2">&quot;-120&quot;</span><span class="p">,</span>
  <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;it-IT&quot;</span><span class="p">,</span>
  <span class="nt">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Borgo San Lorenzo&quot;</span><span class="p">,</span>
  <span class="nt">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;Province of Florence&quot;</span><span class="p">,</span>
  <span class="nt">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Italy&quot;</span><span class="p">,</span>
  <span class="nt">&quot;continent&quot;</span><span class="p">:</span> <span class="s2">&quot;Europe&quot;</span><span class="p">,</span>
  <span class="nt">&quot;latitude&quot;</span><span class="p">:</span> <span class="mf">43.9555</span><span class="p">,</span>
  <span class="nt">&quot;longitude&quot;</span><span class="p">:</span> <span class="mf">11.3856</span><span class="p">,</span>
  <span class="nt">&quot;browser&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla&quot;</span><span class="p">,</span>
  <span class="nt">&quot;browser_version&quot;</span><span class="p">:</span> <span class="s2">&quot;rv:11.0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;agent_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Browser&quot;</span><span class="p">,</span>
  <span class="nt">&quot;agent_category&quot;</span><span class="p">:</span> <span class="s2">&quot;Personal computer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;Windows&quot;</span><span class="p">,</span>
  <span class="nt">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;Windows&quot;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The site gets 200 million hits per day which means approx:</p>
<ul>
<li>73 billion hits a year</li>
<li>6 billion hits a month</li>
<li>8,333,333 hits per hour</li>
<li>138,888 hits per minute</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>They need to answer questions mainly about unique sessions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The on prem hardware specs is:</p>

<pre><code>- 2x 8-core HT processors (16 cores total, 32 hardware threads) 64GB memory 600GB SSD disk</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-many-servers-will-be-necessary-for-an-analytics-cluster-for-one-year-of-this-dataset">How many servers will be necessary for an analytics cluster for one year of this dataset<a class="anchor-link" href="#How-many-servers-will-be-necessary-for-an-analytics-cluster-for-one-year-of-this-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For this question, I'm assuming the Koala already has a deep storage system (S3, HDFS, local....) set up to store the segments.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since the traffic is very high we are going to use a cluster deployment. One of the main advantage of using clustering is the ability to scale horizontally on demand. That allows us to start small and then increase our hardware if needed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a Production setup, here is my recommendation (we need a highly available and fault tolerant setup) :</p>
<ul>
<li>3 Master servers</li>
<li>2 query servers</li>
<li>4 data servers</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can start with that and monitor (using Clarity) in case we need to scale out any resources. My main concern when analyzing this question was the <strong>data servers</strong>, but since those can be added on the fly, we can start with 4 and increase if needed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Further-reasearch">Further reasearch<a class="anchor-link" href="#Further-reasearch">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>roll up and metrics at ingestion time</li>
<li>break apart the Data server components (see <a href="https://medium.com/airbnb-engineering/druid-airbnb-data-platform-601c312f2a4c">https://medium.com/airbnb-engineering/druid-airbnb-data-platform-601c312f2a4c</a> as example) </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sources:</p>
<ul>
<li><a href="https://docs.imply.io/on-prem/deploy/cluster">https://docs.imply.io/on-prem/deploy/cluster</a></li>
<li><a href="https://druid.apache.org/docs/latest/tutorials/cluster.html">https://druid.apache.org/docs/latest/tutorials/cluster.html</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-these-servers-should-be-configured-(JVM-config,-Druid-runtime.properties)">How these servers should be configured (JVM config, Druid runtime.properties)<a class="anchor-link" href="#How-these-servers-should-be-configured-(JVM-config,-Druid-runtime.properties)">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Comparisson-between-r4.2xlarge-and-Koala's-hardware-(https://aws.amazon.com/ec2/instance-types/-and-https://en.wikichip.org/wiki/intel/xeon_e5/e5-2686_v4):">Comparisson between r4.2xlarge and Koala's hardware (<a href="https://aws.amazon.com/ec2/instance-types/">https://aws.amazon.com/ec2/instance-types/</a> and <a href="https://en.wikichip.org/wiki/intel/xeon_e5/e5-2686_v4">https://en.wikichip.org/wiki/intel/xeon_e5/e5-2686_v4</a>):<a class="anchor-link" href="#Comparisson-between-r4.2xlarge-and-Koala's-hardware-(https://aws.amazon.com/ec2/instance-types/-and-https://en.wikichip.org/wiki/intel/xeon_e5/e5-2686_v4):">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th></th>
<th>Koala's server</th>
<th>AWS r4.2xlarge</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cores total</td>
<td>16</td>
<td>18</td>
</tr>
<tr>
<td>Threads</td>
<td>32</td>
<td>36</td>
</tr>
<tr>
<td>RAM</td>
<td>64</td>
<td>61</td>
</tr>
<tr>
<td>Disk</td>
<td>600 GB SSD</td>
<td>Configurable</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As per (<a href="https://docs.imply.io/on-prem/deploy/cluster#configuration-tuning">https://docs.imply.io/on-prem/deploy/cluster#configuration-tuning</a>)</p>
<blockquote><p>If you are using r4.2xlarge EC2 instances or similar hardware, the configuration in the distribution is a reasonable starting point.</p>
</blockquote>
<p>Based on the table above, we can see the hardware it's actually similar.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="jvm.config">jvm.config<a class="anchor-link" href="#jvm.config">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use the example <code>jvm.config</code> for our servers since the amount of RAM in the examples (<a href="https://docs.imply.io/on-prem/deploy/cluster">https://docs.imply.io/on-prem/deploy/cluster</a>) is equal to Koala's RAM per server. (see <code>jvm.config</code> files in <code>imply-3.1.6/dist/druid/conf/druid/cluster/</code>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="runtime.properties">runtime.properties<a class="anchor-link" href="#runtime.properties">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'm going to list some of the values below, for more information see the <code>runtime.properties</code> files in <code>imply-3.1.6/dist/druid/conf/druid/cluster</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>data/middleManager/runtime.properties:druid.server.http.numThreads=60\
data/historical/runtime.properties:druid.server.http.numThreads=60\
query/broker/runtime.properties:druid.server.http.numThreads=60\
query/router/runtime.properties:druid.server.http.numThreads=100</p>
<p>data/historical/runtime.properties:druid.cache.sizeInBytes=256000000\
data/middleManager/runtime.properties:druid.indexer.fork.property.druid.processing.buffer.sizeBytes=100000000\
data/historical/runtime.properties:druid.processing.buffer.sizeBytes=500000000\
query/broker/runtime.properties:druid.processing.buffer.sizeBytes=500000000</p>
<p>.
.
.
.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-Imply-can-be-used-to-answer-the-two-sample-queries-provided-by-Koala-(number-of-unique-sessions-in-a-particular-month;-number-of-unique-sessions-per-country-in-a-particular-day).">How Imply can be used to answer the two sample queries provided by Koala (number of unique sessions in a particular month; number of unique sessions per country in a particular day).<a class="anchor-link" href="#How-Imply-can-be-used-to-answer-the-two-sample-queries-provided-by-Koala-(number-of-unique-sessions-in-a-particular-month;-number-of-unique-sessions-per-country-in-a-particular-day).">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use <code>Pivot</code> or <code>SQL</code> to answer the questions above. Please see below how to answer the questions using <code>SQL</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="number-of-unique-sessions-in-a-particular-month">number of unique sessions in a particular month<a class="anchor-link" href="#number-of-unique-sessions-in-a-particular-month">&#182;</a></h4><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">(</span><span class="k">session</span><span class="p">))</span> <span class="k">AS</span> <span class="n">unique_sessions</span>
    <span class="k">FROM</span> <span class="n">koala_sessions</span>
    <span class="k">WHERE</span> <span class="ss">&quot;__time&quot;</span> <span class="k">BETWEEN</span> <span class="k">TIMESTAMP</span> <span class="s1">&#39;YYYY-MM-01 00:00:00&#39;</span> <span class="k">AND</span> <span class="k">TIMESTAMP</span> <span class="s1">&#39;YYYY-(MM+1)-01 00:00:00&#39;</span>
</pre></div>

<pre><code>where koala_sessions is the datasource name and MM will be the month we want to get the information for.</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="number-of-unique-sessions-per-country-in-a-particular-day">number of unique sessions per country in a particular day<a class="anchor-link" href="#number-of-unique-sessions-per-country-in-a-particular-day">&#182;</a></h4><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="p">(</span><span class="k">session</span><span class="p">))</span> <span class="k">AS</span> <span class="n">unique_sessions</span><span class="p">,</span> <span class="n">country</span>
    <span class="k">FROM</span> <span class="n">koala_sessions</span>
    <span class="k">WHERE</span> <span class="ss">&quot;__time&quot;</span> <span class="k">BETWEEN</span> <span class="k">TIMESTAMP</span> <span class="s1">&#39;YYYY-MM-DD 00:00:00&#39;</span> <span class="k">AND</span> <span class="k">TIMESTAMP</span> <span class="s1">&#39;YYYY-MM-(DD+1) 00:00:00&#39;</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country</span>
</pre></div>

<pre><code>where koala_sessions is the datasource name and YYYY == year, MM == month, DD == day</code></pre>

</div>
</div>
</div>
</div>
 

